<%@ page language="java" contentType="text/html; charset=ISO-8859-1"
    pageEncoding="ISO-8859-1"%>
<%@ page import="Presentacion.*" %>
<%@ page import="Negocio.tomaynotificacionpedidos.*" %>
<%@ page import="java.util.*" %>

<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<script src="//code.jquery.com/jquery-1.11.3.min.js"></script>
<script src="//code.jquery.com/jquery-migrate-1.2.1.min.js"></script>
<script type="text/javascript">
	function ingresarproducto(x){
        var url = '/Meerkat_0.0/consultarproductosvista/tablapedidos/tablapedidos.jsp?id='+x;
        alert(url);
        $("#table1").load(url);
	}
	
	function ingresarproducto1(x){ 
				$.post("/Meerkat_0.0/consultarproductosvista/tablapedidos/tablapedidos.jsp", {
					idp : x
				}, function(responseText) {
					$('#table1').html(responseText);
				});
		}
	
</script>
<title>Consultar productos</title>
<% consultarproductosFacade x = new consultarproductosFacade(); 
   Pedido pedido = null;%>
</head>
<body>
	<div id="boton1">
		<% 
		ArrayList<Producto> y = x.main();
		for(Producto producto: y){
			%><input size="15" maxlength="15" name="producto-<%out.print(producto.getCodigo());%>" type="submit"
			value="<%out.println(producto.getNombre());%>" onclick="ingresarproducto1(<%out.println(producto.getCodigo());%>);"><%
			out.println(producto.getValor()); 
			}
		%>
	</div>
	<div id="table1">
	<%	
		consultarpedidosFacade x1 = new consultarpedidosFacade();
		//out.print("llegó");
		ArrayList<Producto> z = x1.main(2);
		//out.print(z);
		out.print(pedido);
		if(z.size()==0){
			out.print("entró if");
			pedido = new Pedido(z);
		}
		//out.print("salió");
		for(Producto producto: y){
			//out.println("entró en ciclo");
			//out.println(producto.getCodigo());
			//out.println(datoUno);
			if(producto.getCodigo().equals(datoUno)){ 
				//out.print(producto.getCodigo() + "seleccionado");
				z.add(producto);
				};
		}
		pedido.setCuerpo(z);
		ArrayList<Producto> visitados = new ArrayList<Producto>();
		for(Producto producto: pedido.getCuerpo()){
			if(visitados.contains(producto)) continue;
			int aux=0;
			for(Producto auxproducto: pedido.getCuerpo()){
				if(producto==auxproducto){
					aux++;
					visitados.add(auxproducto);
				}
			}
			out.print(producto.getNombre());
			out.print(" " + aux);
		}
	%>
	</div>
</body>
</html>